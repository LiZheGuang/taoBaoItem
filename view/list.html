<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .findBox {
            padding: 30px;
        }
    </style>
</head>

<body>
    <div class="container-fluid findBox">
        <div class="row">
            <div class="col-md-10">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <!-- <th>#</th> -->
                            <th>序号</th>
                            <th>来源</th>
                            <th>商品标题</th>
                            <th>价格</th>
                            <th>付款人数</th>
                            <th>店铺名称</th>
                            <th>地点</th>
                            <th>功能</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% for(var i=0; i<data.listItem.length; i++) {%>
                            <% var item = data.listItem[i] %>

                                <tr data-id='<%= item.item_id%>'>
                                    <th scope="row">
                                        <%= i %>
                                    </th>
                                    <td>淘宝</td>
                                    <td>
                                        <%= item.title %>
                                    </td>
                                    <td>
                                        <%= item.price%>
                                    </td>
                                    <td>
                                        <%= item.act%>
                                    </td>
                                    <td>
                                        <%= item.nick%>
                                    </td>
                                    <td>
                                        <%= item.location%>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-primary">查看链接</button>
                                    </td>
                                </tr>
                                <% } %>

                    </tbody>
                </table>
            </div>
            <div class="col-md-2">

                <button type="button" class="btn btn-info btn-block location" data-href='/page/helloworld?q=<%= q %>' id="zongHePaiXu">综合排序</button>
                <button type="button" class="btn btn-info btn-block location" data-href='/page/helloworld?q=<%= q %>&sort=_bid' id="_bid">价格高到低</button>


                <button type="button" class="btn btn-info btn-block location" id="bind" data-href='/page/helloworld?q=<%= q %>&sort=bind'>价格低到高</button>
                <button type="button" class="btn btn-info btn-block location" id="_ratesum" data-href='/page/helloworld?q=<%= q %>&sort=_ratesum'>信用排序</button>
                <button type="button" class="btn btn-info btn-block location" id="_sale" data-href='/page/helloworld?q=<%= q %>&sort=_sale'>销量优先</button>
                <button type="button" id="openText" class="btn btn-info btn-block ">导出</button>
                <button type="button" class="btn btn-info btn-block">复制所有链接</button>
                <button type="button" class="btn btn-info btn-block">重置</button>

            </div>
        </div>
    </div>


    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script>
        var saveAs = saveAs || (function (view) {
            "use strict";
            // IE <10 is explicitly unsupported  
            if (typeof view === "undefined" || typeof navigator !== "undefined" && /MSIE [1-9]\./.test(navigator.userAgent)) {
                return;
            }
            var
                doc = view.document
                // only get URL when necessary in case Blob.js hasn't overridden it yet  
                , get_URL = function () {
                    return view.URL || view.webkitURL || view;
                }
                , save_link = doc.createElementNS("http://www.w3.org/1999/xhtml", "a")
                , can_use_save_link = "download" in save_link
                , click = function (node) {
                    var event = new MouseEvent("click");
                    node.dispatchEvent(event);
                }
                , is_safari = /constructor/i.test(view.HTMLElement) || view.safari
                , is_chrome_ios = /CriOS\/[\d]+/.test(navigator.userAgent)
                , throw_outside = function (ex) {
                    (view.setImmediate || view.setTimeout)(function () {
                        throw ex;
                    }, 0);
                }
                , force_saveable_type = "application/octet-stream"
                // the Blob API is fundamentally broken as there is no "downloadfinished" event to subscribe to  
                , arbitrary_revoke_timeout = 1000 * 40 // in ms  
                , revoke = function (file) {
                    var revoker = function () {
                        if (typeof file === "string") { // file is an object URL  
                            get_URL().revokeObjectURL(file);
                        } else { // file is a File  
                            file.remove();
                        }
                    };
                    setTimeout(revoker, arbitrary_revoke_timeout);
                }
                , dispatch = function (filesaver, event_types, event) {
                    event_types = [].concat(event_types);
                    var i = event_types.length;
                    while (i--) {
                        var listener = filesaver["on" + event_types[i]];
                        if (typeof listener === "function") {
                            try {
                                listener.call(filesaver, event || filesaver);
                            } catch (ex) {
                                throw_outside(ex);
                            }
                        }
                    }
                }
                , auto_bom = function (blob) {
                    // prepend BOM for UTF-8 XML and text/* types (including HTML)  
                    // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF  
                    if (/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(blob.type)) {
                        return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type });
                    }
                    return blob;
                }
                , FileSaver = function (blob, name, no_auto_bom) {
                    if (!no_auto_bom) {
                        blob = auto_bom(blob);
                    }
                    // First try a.download, then web filesystem, then object URLs  
                    var
                        filesaver = this
                        , type = blob.type
                        , force = type === force_saveable_type
                        , object_url
                        , dispatch_all = function () {
                            dispatch(filesaver, "writestart progress write writeend".split(" "));
                        }
                        // on any filesys errors revert to saving with object URLs  
                        , fs_error = function () {
                            if ((is_chrome_ios || (force && is_safari)) && view.FileReader) {
                                // Safari doesn't allow downloading of blob urls  
                                var reader = new FileReader();
                                reader.onloadend = function () {
                                    var url = is_chrome_ios ? reader.result : reader.result.replace(/^data:[^;]*;/, 'data:attachment/file;');
                                    var popup = view.open(url, '_blank');
                                    if (!popup) view.location.href = url;
                                    url = undefined; // release reference before dispatching  
                                    filesaver.readyState = filesaver.DONE;
                                    dispatch_all();
                                };
                                reader.readAsDataURL(blob);
                                filesaver.readyState = filesaver.INIT;
                                return;
                            }
                            // don't create more object URLs than needed  
                            if (!object_url) {
                                object_url = get_URL().createObjectURL(blob);
                            }
                            if (force) {
                                view.location.href = object_url;
                            } else {
                                var opened = view.open(object_url, "_blank");
                                if (!opened) {
                                    // Apple does not allow window.open, see https://developer.apple.com/library/safari/documentation/Tools/Conceptual/SafariExtensionGuide/WorkingwithWindowsandTabs/WorkingwithWindowsandTabs.html  
                                    view.location.href = object_url;
                                }
                            }
                            filesaver.readyState = filesaver.DONE;
                            dispatch_all();
                            revoke(object_url);
                        }
                        ;
                    filesaver.readyState = filesaver.INIT;

                    if (can_use_save_link) {
                        object_url = get_URL().createObjectURL(blob);
                        setTimeout(function () {
                            save_link.href = object_url;
                            save_link.download = name;
                            click(save_link);
                            dispatch_all();
                            revoke(object_url);
                            filesaver.readyState = filesaver.DONE;
                        });
                        return;
                    }

                    fs_error();
                }
                , FS_proto = FileSaver.prototype
                , saveAs = function (blob, name, no_auto_bom) {
                    return new FileSaver(blob, name || blob.name || "download", no_auto_bom);
                }
                ;
            // IE 10+ (native saveAs)  
            if (typeof navigator !== "undefined" && navigator.msSaveOrOpenBlob) {
                return function (blob, name, no_auto_bom) {
                    name = name || blob.name || "download";

                    if (!no_auto_bom) {
                        blob = auto_bom(blob);
                    }
                    return navigator.msSaveOrOpenBlob(blob, name);
                };
            }

            FS_proto.abort = function () { };
            FS_proto.readyState = FS_proto.INIT = 0;
            FS_proto.WRITING = 1;
            FS_proto.DONE = 2;

            FS_proto.error =
                FS_proto.onwritestart =
                FS_proto.onprogress =
                FS_proto.onwrite =
                FS_proto.onabort =
                FS_proto.onerror =
                FS_proto.onwriteend =
                null;

            return saveAs;
        }(
            typeof self !== "undefined" && self
            || typeof window !== "undefined" && window
            || this.content
        ));
        // `self` is undefined in Firefox for Android content script context  
        // while `this` is nsIContentFrameMessageManager  
        // with an attribute `content` that corresponds to the window  

        if (typeof module !== "undefined" && module.exports) {
            module.exports.saveAs = saveAs;
        } else if ((typeof define !== "undefined" && define !== null) && (define.amd !== null)) {
            define("FileSaver.js", function () {
                return saveAs;
            });
        }

    </script>

    <script>
        window.onload = function () {


            $('#openText').on('click', function () {
                console.log('123')
                var blob = new Blob([listItem()], { type: "text/plain;charset=utf-8" });
                saveAs(blob, "taoBaoItem");
            })
            $('.location').on('click', function () {
                window.location = $(this).attr('data-href')
            })

            function listItem() {
                var configUrl = 'https://item.taobao.com/item.htm?id='
                var lisTr = $('body tbody tr')
                var content = ''
                lisTr.each(function (res, item) {
                    let id = item.dataset.id
                    content += configUrl + id + '\r\n'
                    console.log(id)
                })

                return content

            }


        }
    </script>
</body>

</html>